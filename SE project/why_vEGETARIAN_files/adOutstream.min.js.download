!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/.bootscripts/",i(i.s=223)}({223:function(t,e,i){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function o(t){var e="function"==typeof Map?new Map:void 0;return(o=function(t){if(null===t||(i=t,-1===Function.toString.call(i).indexOf("[native code]")))return t;var i;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return s(t,arguments,u(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),l(n,t)})(t)}function s(t,e,i){return(s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,i){var n=[null];n.push.apply(n,e);var r=new(Function.bind.apply(t,n));return i&&l(r,i.prototype),r}).apply(null,arguments)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var c=-1!==window.location.hash.indexOf("force-outstream-fallback");void 0===window.outstreamDebugging&&(window.outstreamDebugging=[]);var d=i(224),h=i(225),p=i(226),y=p.config,f=i(227);var b=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),a(this,u(e).apply(this,arguments))}var i,n,s;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(e,o(HTMLElement)),i=e,s=[{key:"observedAttributes",get:function(){return["vast-url"]}}],(n=[{key:"attributeChangedCallback",value:function(t,e,i){"vast-url"===t&&i&&i.length&&(c||this.gdprApplicable?(c&&console.log("forcing a failure for outstream unit; vast-url was",i),this.emitFailureEvent(),this.destroy()):(this.vastUrl=this.getAttribute("vast-url"),this.initialize()))}},{key:"connectedCallback",value:function(){var t=this;if(!window.GdprStatus)throw new Error("window.GdprStatus is required");this.adLoaded=!1,this.boundCallbacks=this.bindCallbacks(),this.clickoutUrl=null,this.didEnd=!1,this.interface=this.generateInterface(),this.isDestroyed=!1,this.isInitialized=!1,this.isShown=!1,this.libReady=!1,this.onScreen=!1,this.shouldPlayOnShow=!1,this.vastValid=!1,this.volume=null,window.GdprStatus.isApplicable().then(function(e){e?t.gdprApplicable=!0:d.observe(t,1600)})}},{key:"initialize",value:function(){!this.isInitialized&&!this.isDestroyed&&this.libReady&&this.vastUrl&&(this.isInitialized=!0,this.closeButton=this.querySelector(".m-ad-outstream--close-btn"),this.cta=this.querySelector(".m-ad-outstream--cta"),this.visibilityWatcher=new IntersectionObserver(this.boundCallbacks.onVisibilityChange,{threshold:y.threshold}),this.visibilityWatcher.observe(this),this.player.setup(this.vastUrl,this.getAttribute("player-bidding"),this.querySelector(".m-ad-outstream--mute-toggle")),window.outstreamDebugging.push({type:"setup",vastUrl:this.vastUrl,bidding:this.getAttribute("player-bidding")}),this.addListeners(),this.play(!0))}},{key:"addListeners",value:function(){this.cta.addEventListener("click",this.boundCallbacks.ctaClickHandler),this.closeButton.addEventListener("click",this.boundCallbacks.closeClickHandler),this.player.on("setupError",this.boundCallbacks.playerErrorHandler),this.player.on("complete",this.boundCallbacks.playbackEndedHandler),this.player.on("adError",this.boundCallbacks.adErrorHandler),this.player.on("adImpression",this.boundCallbacks.adImpressionHandler),this.player.on("adStarted",this.boundCallbacks.adStartedHandler)}},{key:"removeListeners",value:function(){this.player&&this.player.off&&(this.player.off("setupError",this.boundCallbacks.playerErrorHandler),this.player.off("complete",this.boundCallbacks.playbackEndedHandler),this.player.off("adError",this.boundCallbacks.adErrorHandler),this.player.off("adImpression",this.boundCallbacks.adImpressionHandler),this.player.off("adStarted",this.boundCallbacks.adStartedHandler)),this.closeButton&&this.closeButton.removeEventListener("click",this.boundCallbacks.closeClickHandler),this.cta&&this.cta.removeEventListener("click",this.boundCallbacks.ctaClickHandler)}},{key:"instantiatePlayer",value:function(){var t=this;this.playerContainer=this.querySelector(".m-ad-outstream--player"),y.scriptSrc=this.hasAttribute("scriptoverride")?p.selfhostedScriptUrl:p.scriptUrl;try{this.iframe=function(){var t=document.createElement("iframe"),e=!!("srcdoc"in t);if(t.classList.add("m-ad-outstream--iframe"),!e)throw"Insufficient iframe support";return t}(),this.playerContainer.prepend(this.iframe),this.iframe.addEventListener("load",function(){t.player||(t.player=new h(t.iframe.contentWindow,y,t.interface))}),this.iframe.contentWindow.document.open(),this.iframe.contentWindow.document.write(f),this.iframe.contentWindow.document.close()}catch(t){console.warn("Outstream instantiation error",t),this.emitFailureEvent(),this.destroy()}}},{key:"attemptToShow",value:function(){this.adLoaded&&(this.onScreen||this.getIsBelowViewport())&&this.show()}},{key:"showHeader",value:function(){this.parentNode&&this.parentNode.querySelector(".m-ad-outstream--header").classList.add("is-shown")}},{key:"hideHeader",value:function(){this.parentNode&&this.parentNode.querySelector(".m-ad-outstream--header").classList.remove("is-shown")}},{key:"show",value:function(){this.isShown=!0,this.classList.add("is-shown"),this.showHeader(),this.shouldPlayOnShow&&(this.shouldPlayOnShow=void 0,this.play())}},{key:"hide",value:function(){var t=this;this.classList.remove("is-shown"),this.cta&&this.cta.classList.add("is-hidden"),setTimeout(function(){t.hideHeader()},y.containerAnimationDuration)}},{key:"hidePlayer",value:function(){this.querySelector(".m-ad-outstream--player").style.display="none"}},{key:"generateInterface",value:function(){return{libReady:this.boundCallbacks.libReadyHandler,libLoadError:this.boundCallbacks.libLoadError}}},{key:"bindCallbacks",value:function(){return{libReadyHandler:this.libReadyHandler.bind(this),libLoadError:this.libLoadError.bind(this),onVisibilityChange:this.onVisibilityChange.bind(this),adImpressionHandler:this.adImpressionHandler.bind(this),adErrorHandler:this.adErrorHandler.bind(this),adStartedHandler:this.adStartedHandler.bind(this),playbackEndedHandler:this.playbackEndedHandler.bind(this),playerErrorHandler:this.playerErrorHandler.bind(this),ctaClickHandler:this.ctaClickHandler.bind(this),closeClickHandler:this.closeClickHandler.bind(this)}}},{key:"getIsBelowViewport",value:function(){return this.getBoundingClientRect().top>=window.innerHeight}},{key:"closeClickHandler",value:function(){this.destroy()}},{key:"ctaClickHandler",value:function(){this.clickoutUrl&&window.open(this.clickoutUrl,"_blank")}},{key:"adErrorHandler",value:function(t){this.vastValid=!1,this.emitFailureEvent(),this.hide(),this.destroy(),window.outstreamDebugging.push({type:"error",obj:t})}},{key:"validateImaSDKDataPromise",value:function(t){return new Promise(function(e,i){t||e();var n=!0,r=!1,a=void 0;try{for(var o,s=y.roadblockSizes[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value,u=l.split("x");if(t.vastMediaWidth===parseInt(u[0],10)&&t.vastMediaHeight===parseInt(u[1],10)){i(l);break}}}catch(t){r=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(r)throw a}}t.duration<=y.minAllowedDuration&&i("duration_is_lte_than_".concat(y.minAllowedDuration,"_sec")),e()})}},{key:"adImpressionHandler",value:function(t){var e=this,i=t&&t.ima&&t.ima.ad&&t.ima.ad.g;this.validateImaSDKDataPromise(i).then(function(){e.vastValid||(e.adLoaded=!0,e.player.seek("0"),e.attemptToShow(),e.onScreen||setTimeout(function(){e.pause()})),window.outstreamDebugging.push({type:"impression",obj:t}),t&&t.clickThroughUrl?e.clickoutUrl=t.clickThroughUrl:i&&i.clickThroughUrl&&(e.clickoutUrl=i.clickThroughUrl),e.clickoutUrl&&e.cta.classList.add("include-cta"),e.vastValid=!0}).catch(function(t){window.outstreamDebugging.push({type:"roadblock_".concat(t),obj:i}),e.emitFailureEvent(),e.destroy()})}},{key:"adStartedHandler",value:function(t){this.onScreen||this.player.pause()}},{key:"playbackEndedHandler",value:function(){this.player.ended(),this.didEnd=!0,this.hidePlayer(),this.exposeEndcard()}},{key:"exposeEndcard",value:function(){this.cta.classList.add("is-shown"),this.closeButton.classList.add("is-shown")}},{key:"playerErrorHandler",value:function(){this.emitFailureEvent(),this.destroy()}},{key:"emitFailureEvent",value:function(){this.dispatchEvent(new CustomEvent("outstreamFailed"))}},{key:"onVisibilityChange",value:function(t){this.isDestroyed||this.didEnd||(t[0].intersectionRatio>=y.threshold?this.onContainerVisible():this.onContainerNotVisible())}},{key:"onContainerVisible",value:function(){this.onScreen=!0,this.isShown?this.play():this.shouldPlayOnShow=!0,this.attemptToShow()}},{key:"onContainerNotVisible",value:function(){this.onScreen=!1,this.pause()}},{key:"play",value:function(t){!0!==t?this.player&&"playing"!==this.player.getState()&&this.player.play():this.player.play()}},{key:"pause",value:function(){this.player.pause()}},{key:"libReadyHandler",value:function(){this.libReady=!0,this.initialize()}},{key:"libLoadError",value:function(t){console.warn(t),this.emitFailureEvent(),this.destroy()}},{key:"onObserved",value:function(){this.instantiatePlayer()}},{key:"destroy",value:function(){var t=this;if(!this.isDestroyed){var e=this.isShown?y.containerAnimationDuration:0;this.isDestroyed=!0,this.hide(),setTimeout(function(){t.removeListeners(),t.visibilityWatcher&&(t.visibilityWatcher.unobserve(t),t.visibilityWatcher.disconnect(t)),t.cta&&t.cta.classList.remove("is-shown"),t.closeButton&&t.closeButton.classList.remove("is-shown");try{t.player.destroy()}catch(t){}t.visibilityWatcher=null,t.boundCallbacks=null,t.interface=null,t.player=null,t.closeButton=null,t.cta=null},e)}}},{key:"vastValid",get:function(){return"true"===this.getAttribute("vast-valid")},set:function(t){this.setAttribute("vast-valid",!!t)}}])&&r(i.prototype,n),s&&r(i,s),e}();window.customElements.define("phoenix-ad-outstream",b)},224:function(t,e,i){"use strict";var n={};t.exports={observe:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:800;n[e]||(n[e]=function(t){return new IntersectionObserver(function(t,e){t.forEach(function(t){t.isIntersecting&&(e.unobserve(t.target),t.target.onObserved())})},{rootMargin:t+"px 0px"})}(e)),n[e].observe(t)},unobserve:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:800;n[e].unobserve(t)}}},225:function(t,e){t.exports=function(t,e,i){var n,r=t.document;function a(){new Promise(function(t,i){var n=r.createElement("script");n.addEventListener("load",function(){t()}),n.addEventListener("error",function(t){i(t)}),n.src=e.scriptSrc,r.head.appendChild(n)}).then(function(){u=!0,i.libReady()}).catch(function(t){i.libLoadError(t)})}var o,s,l,u=!1,c=a.prototype,d=!0,h=!1;function p(){t.addEventListener("focus",y)}function y(){t.removeEventListener("focus",y),h||n.play()}function f(t){t.stopPropagation(),t.preventDefault(),d=!d,c.setMute(d),d?(l.style.display="none",s.style.display="block"):(l.style.display="block",s.style.display="none")}return c.setup=function(i,a,u){if(!n){var c=r.querySelector(".m-ad-outstream--player-container"),d={file:e.fileUrl,repeat:!1,mute:!0,width:"100%",aspectratio:"16:9",skin:{name:"ad-outstream-say"},advertising:{autoplayadsmuted:!0,client:"googima",requestTimeout:15e3,schedule:{adbreak:{tag:i,offset:"pre"}}}};if(a)try{a=JSON.parse(a),d.advertising.bids={settings:{mediationLayerAdServer:"dfp"},bidders:a}}catch(t){a=void 0}(n=t.jwplayer(c)).setup(d),o=u,s=u.querySelector(".m-ad-outstream--unmute-icon"),(l=u.querySelector(".m-ad-outstream--mute-icon")).style.display="none",o.addEventListener("click",f),n.on("adClick",p)}},c.ended=function(){h=!0},c.on=function(t,e){n.on(t,e)},c.off=function(t,e){n&&n.off(t,e)},c.isLibLoaded=function(){return u},c.pause=function(){n.pause()},c.play=function(){n.play()},c.seek=function(t){n.seek(t)},c.getState=function(){return n.getState()},c.setMute=function(t){n.setMute(t)},c.destroy=function(){o.removeEventListener("click",f),n&&n.off("adClick",p),t.removeEventListener("focus",y),n.remove(),n=null},new a}},226:function(t,e,i){"use strict";t.exports={config:{containerAnimationDuration:700,fileUrl:"https://adcontent.saymedia.com/black-1s.mp4",threshold:.5,minAllowedDuration:1,roadblockSizes:["7x7","8x8"]},scriptUrl:"https://content.jwplatform.com/libraries/l0Tc9yhq.js",selfhostedScriptUrl:"https://adcontent.saymedia.com/jwplayer-outstream-selfhosted.js"}},227:function(t,e){t.exports='<!doctype html> <html> <head> <title></title> <meta name=viewport content="width=device-width,initial-scale=1"> <style type=text/css>body,div{margin:0;padding:0}.m-ad-outstream--player-container{width:640px;height:320px}.jwplayer{width:100%!important;height:100%!important}.jw-button-container{visibility:hidden}.jw-display-controls{display:none}.jw-slider-time{visibility:hidden}.jw-state-paused .jw-slider-time,.jw-state-playing .jw-slider-time{visibility:visible}</style> </head> <body> <div class=m-ad-outstream--player-container></div> </body> </html> '}});
//# sourceMappingURL=adOutstream.min.js.map